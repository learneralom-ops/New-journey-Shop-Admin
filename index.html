<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daraz Admin | Secure Login</title>
<style>
*{box-sizing:border-box;font-family:Arial, sans-serif}
body{margin:0;background:#f5f5f5}
.hidden{display:none}

/* Login UI */
.login{height:100vh;display:flex;justify-content:center;align-items:center}
.login-box{background:#fff;padding:25px;width:320px;border-radius:10px;box-shadow:0 10px 25px rgba(0,0,0,0.1)}
.login-box h2{text-align:center;color:#f85606;margin-bottom:20px}
.login-box input{width:100%;padding:12px;margin-top:10px;border:1px solid #ddd;border-radius:5px}
.login-box button{width:100%;padding:12px;margin-top:15px;background:#f85606;color:#fff;border:none;border-radius:5px;cursor:pointer;font-weight:bold}

/* Admin Panel UI */
header{background:#f85606;color:#fff;padding:12px 20px;display:flex;justify-content:space-between;align-items:center}
header button{background:#fff;color:#f85606;border:none;padding:6px 12px;border-radius:4px;cursor:pointer;font-weight:bold}

.container{padding:20px;max-width:800px;margin:auto}
form{background:#fff;padding:20px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.05)}
form h3{margin-top:0;color:#333}
form input, select{width:100%;padding:10px;margin:8px 0;border:1px solid #ddd;border-radius:5px}
form img{max-width:100px;margin-top:10px;border-radius:5px;display:block}

.save-btn{background:#28a745;color:#fff;border:none;padding:12px;width:100%;border-radius:5px;cursor:pointer;font-size:16px;margin-top:10px}
.reset-btn{background:#6c757d;color:#fff;border:none;padding:8px;width:100%;border-radius:5px;cursor:pointer;margin-top:5px}

.products-list{margin-top:30px}
.card{background:#fff;padding:15px;border-radius:8px;margin-bottom:12px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 5px rgba(0,0,0,0.05)}
.card-info b{display:block;font-size:16px}
.card-btns button{padding:6px 10px;margin-left:5px;cursor:pointer;border-radius:4px;border:none}
.edit-btn{background:#ffc107;color:#000}
.del-btn{background:#dc3545;color:#fff}
</style>
</head>
<body>

<div class="login" id="loginDiv">
  <div class="login-box">
    <h2>üîê Admin Access</h2>
    <input id="emailInput" type="email" placeholder="Email Address">
    <input id="passInput" type="password" placeholder="Password">
    <button id="loginBtn">Login</button>
  </div>
</div>

<div id="adminDiv" class="hidden">
  <header>
    <b>üß° Daraz Deals Admin</b>
    <span id="userEmail" style="font-size: 12px; margin-right: 10px;"></span>
    <button id="logoutBtn">Logout</button>
  </header>

  <div class="container">
    <form id="productForm">
      <h3 id="formTitle">‚ûï Add New Product</h3>
      <input id="title" placeholder="Product Title" required>
      <input id="price" placeholder="Sale Price ‡ß≥" required>
      <input id="old" placeholder="Regular Price ‡ß≥">
      <input id="img" placeholder="Image URL" oninput="preview()">
      <img id="preview" src="">
      <input id="link" placeholder="Affiliate Link" required>
      <select id="category">
        <option>Electronics</option>
        <option>Fashion</option>
        <option>Home</option>
        <option>Gadgets</option>
      </select>
      <input type="datetime-local" id="offerEnd">
      <button type="submit" class="save-btn" id="saveBtn">üíæ Save Product</button>
      <button type="button" class="reset-btn" onclick="resetForm()">‚ôª Reset Form</button>
    </form>

    <div class="products-list" id="productsDiv">‡¶≤‡ßÅ‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
  </div>
</div>

<script type="module">
  // Firebase SDKs
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // --- ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Firebase Config ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡¶∏‡¶æ‡¶® ---
  const firebaseConfig = {
            apiKey: "AIzaSyDbc54ZsWBXFqX50KvY85kbHkUo_Ct5hLk",
            authDomain: "arifa-shop.firebaseapp.com",
            databaseURL: "https://arifa-shop-default-rtdb.firebaseio.com",
            projectId: "arifa-shop",
            storageBucket: "arifa-shop.firebasestorage.app",
            messagingSenderId: "792267788402",
            appId: "1:792267788402:web:96dd32886699ff188472eb"
        };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const colRef = collection(db, "products");

  let editId = null;

  // ‡ßß. ‡¶≤‡¶ó‡¶á‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï
  document.getElementById("loginBtn").onclick = async () => {
    const email = document.getElementById("emailInput").value;
    const pass = document.getElementById("passInput").value;
    try {
      await signInWithEmailAndPassword(auth, email, pass);
    } catch (err) {
      alert("‡¶≤‡¶ó‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: " + err.message);
    }
  };

  // ‡ß®. ‡¶Ö‡¶•‡ßá‡¶®‡¶ü‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡ßç‡¶ü‡ßá‡¶ü ‡¶ö‡ßá‡¶ï (‡¶≤‡¶ó‡¶á‡¶® ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø ‡¶®‡ßá‡¶á)
  onAuthStateChanged(auth, (user) => {
    if (user) {
      document.getElementById("loginDiv").classList.add("hidden");
      document.getElementById("adminDiv").classList.remove("hidden");
      document.getElementById("userEmail").innerText = user.email;
      loadProducts();
    } else {
      document.getElementById("loginDiv").classList.remove("hidden");
      document.getElementById("adminDiv").classList.add("hidden");
    }
  });

  // ‡ß©. ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü
  document.getElementById("logoutBtn").onclick = () => signOut(auth);

  // ‡ß™. ‡¶á‡¶Æ‡ßá‡¶ú ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â
  window.preview = () => {
    document.getElementById("preview").src = document.getElementById("img").value;
  };

  // ‡ß´. ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶ú ‡¶•‡ßá‡¶ï‡ßá ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶≤‡ßã‡¶° (Real-time)
  function loadProducts() {
    onSnapshot(colRef, (snapshot) => {
      const productsDiv = document.getElementById("productsDiv");
      productsDiv.innerHTML = snapshot.empty ? "‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§" : "";
      snapshot.docs.forEach(docSnap => {
        const p = docSnap.data();
        const id = docSnap.id;
        productsDiv.innerHTML += `
          <div class="card">
            <div class="card-info">
              <b>${p.title}</b>
              <small>‡ß≥${p.price} | ${p.category}</small>
            </div>
            <div class="card-btns">
              <button class="edit-btn" onclick="editProduct('${id}')">‚úè</button>
              <button class="del-btn" onclick="deleteProduct('${id}')">‚ùå</button>
            </div>
          </div>`;
      });
    });
  }

  // ‡ß¨. ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶¨‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
  document.getElementById("productForm").onsubmit = async (e) => {
    e.preventDefault();
    const saveBtn = document.getElementById("saveBtn");
    saveBtn.innerText = "Processing...";
    saveBtn.disabled = true;

    const data = {
      title: document.getElementById("title").value,
      price: document.getElementById("price").value,
      old: document.getElementById("old").value,
      img: document.getElementById("img").value,
      link: document.getElementById("link").value,
      category: document.getElementById("category").value,
      offerEnd: document.getElementById("offerEnd").value
    };

    try {
      if (editId) {
        await updateDoc(doc(db, "products", editId), data);
        alert("‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
      } else {
        await addDoc(colRef, data);
        alert("‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
      }
      resetForm();
    } catch (err) {
      alert("Error: " + err.message);
    }
    saveBtn.innerText = "üíæ Save Product";
    saveBtn.disabled = false;
  };

  // ‡ß≠. ‡¶è‡¶°‡¶ø‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
  window.editProduct = (id) => {
    const docRef = doc(db, "products", id);
    onSnapshot(docRef, (docSnap) => {
      if(docSnap.exists()){
        const p = docSnap.data();
        editId = id;
        document.getElementById("formTitle").innerText = "‚úè Edit Product";
        document.getElementById("title").value = p.title;
        document.getElementById("price").value = p.price;
        document.getElementById("old").value = p.old;
        document.getElementById("img").value = p.img;
        document.getElementById("link").value = p.link;
        document.getElementById("category").value = p.category;
        document.getElementById("offerEnd").value = p.offerEnd;
        preview();
        window.scrollTo(0,0);
      }
    });
  };

  // ‡ßÆ. ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
  window.deleteProduct = async (id) => {
    if(confirm("‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")){
      await deleteDoc(doc(db, "products", id));
    }
  };

  // ‡ßØ. ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶´‡¶∞‡ßç‡¶Æ
  window.resetForm = () => {
    editId = null;
    document.getElementById("formTitle").innerText = "‚ûï Add New Product";
    document.getElementById("productForm").reset();
    document.getElementById("preview").src = "";
  };
</script>
</body>
</html>

